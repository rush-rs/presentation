% chktex-file -2
\section{Kompilierung zu LLVM}
\begin{frame}{Was ist LLVM?}
	\begin{itemize}
		\item<1-> Startete als \cemph{Forschungsprojekt}
		\item<2-> Auch Rust und Swift nutzen LLVM
		\item<3-> Erzeugung von Code aus einer \cemph{Zwischendarstellung} (IR)
		\item<4-> Aggressive \cemph{Optimierung}
		\item<5-> Die IR kann mittels APIs erzeugt werden
			\item[\Rightarrow]<6-> Das Backend eines Compilers
	\end{itemize}
\end{frame}

\begin{frame}{Rolle von LLVM in einem Compiler}
	\begin{figure}[h]
		\begin{adjustbox}{max totalsize={\textwidth}{!},center}
			\begin{tikzpicture}[node distance=3mm and 1cm, inner sep=3mm]
				\node (syntactic_analysis_text) [inner sep=0] {syntactical analysis};
				\node (lexical_analysis) [rec, below=of syntactic_analysis_text] {lexical analysis};
				\node (syntactic_analysis) [rec, fit={(syntactic_analysis_text) (lexical_analysis)}] {};

				\node (semantic_analysis) [rec, align=center, right=of syntactic_analysis] {semantic\\analysis};
				\draw [arrow] (syntactic_analysis) -- (semantic_analysis);

				\node (ir_generation) [rec, align=center, right=of semantic_analysis] {LLVM IR\\generation};
				\draw [arrow] (semantic_analysis) -- (ir_generation);

				\node (llvm) [rec, align=center, fill=mLightBrown!25, right=of ir_generation] {LLVM\\backend};
				\draw [arrow] (ir_generation) -- (llvm);
			\end{tikzpicture}
		\end{adjustbox}
		\caption{Etappen der Übersetzung mit Verwendung von LLVM}\label{fig:compilation_steps_llvm}
	\end{figure}
\end{frame}

\begin{frame}{Der rush LLVM Compiler}
	\begin{itemize}
		\item Verwendung einer Rust library names \cemph{Inkwell}
		\item Erzeugung von LLVM IR
	\end{itemize}
\end{frame}

\begin{frame}{Ein LLVM Beispielprogramm: Eingabe}
	\Lirsting[float=H, fancyvrb={frame=none}]{listings/simple.rush}
\end{frame}

\begin{frame}{Ein LLVM Beispielprogramm: Ausgabe}
	\Lirsting[float=H, fancyvrb={frame=none, fontsize=\footnotesize}]{listings/generated/simple.ll}
\end{frame}

\begin{frame}{Fazit}
	\begin{table}[h]
		\rowcolors{2}{gray!15}{}
		\begin{tabularx}{0.95\textwidth}{L|L}
			\cellcolor{green!20} Vorteile                                 & \cellcolor{red!20} Nachteile               \\
            \hline
			hoher Abstraktionsgrad                                        & Aufwendige Installation der LLVM Libraries \\
			Unabhängigkeit von der Zielmaschine                           & signifikante Größe der ausführbaren Datei  \\
			aggressive Optimisierungsmaßnahmen                            & unvollständige Dokumentation von Inkwell   \\
			Ausgabeprogramm ca. 1,7 mal schneller (vgl. x86\_64 Compiler) & Abhängigkeit von einer C++ Codebase        \\
		\end{tabularx}
	\end{table}
\end{frame}
